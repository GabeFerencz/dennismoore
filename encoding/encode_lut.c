#include <stdio.h>
#include <stdlib.h>
#include <stdint.h>
#include <errno.h>
#include <unistd.h>

#define BUFFER_SIZE 256

// Lookup table for byte conversion (big endian)
static uint32_t encode_lut[256] = {
0x99999999, 0x96999999, 0x69999999, 0x66999999, 0x99969999, 0x96969999,
0x69969999, 0x66969999, 0x99699999, 0x96699999, 0x69699999, 0x66699999,
0x99669999, 0x96669999, 0x69669999, 0x66669999, 0x99999699, 0x96999699,
0x69999699, 0x66999699, 0x99969699, 0x96969699, 0x69969699, 0x66969699,
0x99699699, 0x96699699, 0x69699699, 0x66699699, 0x99669699, 0x96669699,
0x69669699, 0x66669699, 0x99996999, 0x96996999, 0x69996999, 0x66996999,
0x99966999, 0x96966999, 0x69966999, 0x66966999, 0x99696999, 0x96696999,
0x69696999, 0x66696999, 0x99666999, 0x96666999, 0x69666999, 0x66666999,
0x99996699, 0x96996699, 0x69996699, 0x66996699, 0x99966699, 0x96966699,
0x69966699, 0x66966699, 0x99696699, 0x96696699, 0x69696699, 0x66696699,
0x99666699, 0x96666699, 0x69666699, 0x66666699, 0x99999996, 0x96999996,
0x69999996, 0x66999996, 0x99969996, 0x96969996, 0x69969996, 0x66969996,
0x99699996, 0x96699996, 0x69699996, 0x66699996, 0x99669996, 0x96669996,
0x69669996, 0x66669996, 0x99999696, 0x96999696, 0x69999696, 0x66999696,
0x99969696, 0x96969696, 0x69969696, 0x66969696, 0x99699696, 0x96699696,
0x69699696, 0x66699696, 0x99669696, 0x96669696, 0x69669696, 0x66669696,
0x99996996, 0x96996996, 0x69996996, 0x66996996, 0x99966996, 0x96966996,
0x69966996, 0x66966996, 0x99696996, 0x96696996, 0x69696996, 0x66696996,
0x99666996, 0x96666996, 0x69666996, 0x66666996, 0x99996696, 0x96996696,
0x69996696, 0x66996696, 0x99966696, 0x96966696, 0x69966696, 0x66966696,
0x99696696, 0x96696696, 0x69696696, 0x66696696, 0x99666696, 0x96666696,
0x69666696, 0x66666696, 0x99999969, 0x96999969, 0x69999969, 0x66999969,
0x99969969, 0x96969969, 0x69969969, 0x66969969, 0x99699969, 0x96699969,
0x69699969, 0x66699969, 0x99669969, 0x96669969, 0x69669969, 0x66669969,
0x99999669, 0x96999669, 0x69999669, 0x66999669, 0x99969669, 0x96969669,
0x69969669, 0x66969669, 0x99699669, 0x96699669, 0x69699669, 0x66699669,
0x99669669, 0x96669669, 0x69669669, 0x66669669, 0x99996969, 0x96996969,
0x69996969, 0x66996969, 0x99966969, 0x96966969, 0x69966969, 0x66966969,
0x99696969, 0x96696969, 0x69696969, 0x66696969, 0x99666969, 0x96666969,
0x69666969, 0x66666969, 0x99996669, 0x96996669, 0x69996669, 0x66996669,
0x99966669, 0x96966669, 0x69966669, 0x66966669, 0x99696669, 0x96696669,
0x69696669, 0x66696669, 0x99666669, 0x96666669, 0x69666669, 0x66666669,
0x99999966, 0x96999966, 0x69999966, 0x66999966, 0x99969966, 0x96969966,
0x69969966, 0x66969966, 0x99699966, 0x96699966, 0x69699966, 0x66699966,
0x99669966, 0x96669966, 0x69669966, 0x66669966, 0x99999666, 0x96999666,
0x69999666, 0x66999666, 0x99969666, 0x96969666, 0x69969666, 0x66969666,
0x99699666, 0x96699666, 0x69699666, 0x66699666, 0x99669666, 0x96669666,
0x69669666, 0x66669666, 0x99996966, 0x96996966, 0x69996966, 0x66996966,
0x99966966, 0x96966966, 0x69966966, 0x66966966, 0x99696966, 0x96696966,
0x69696966, 0x66696966, 0x99666966, 0x96666966, 0x69666966, 0x66666966,
0x99996666, 0x96996666, 0x69996666, 0x66996666, 0x99966666, 0x96966666,
0x69966666, 0x66966666, 0x99696666, 0x96696666, 0x69696666, 0x66696666,
0x99666666, 0x96666666, 0x69666666, 0x66666666};

static inline uint32_t * encode(uint8_t byte)
{
	// Lookup input byte and return pointer to the resulting uint32_t
	return &encode_lut[byte];
}

/* Example:
 * echo -n "hello world!" | ./encode_lut |  perl -lpe '$_=unpack"B*"'
 *
 * outputs:
 * 10010110011010010110100110011001100101100110100110010110100101101001
 * 01100110100101100110100110011001011001101001011001101001100110010110
 * 01101001011001100110011010011001011010011001100110011001100101100110
 * 01101001011001100110100101100110100101100110011001101001011001100110
 * 10011001011010011001011001101001011001101001100110010110011010011001
 * 01101001100110011001011010011001100110010110
 */

int main(int argc, char* argv[]) {
	// Number of bytes returned by read() and write()
	ssize_t ret_in;
	ssize_t ret_out;

	// Input buffer
	char buffer[BUFFER_SIZE];

	while ((ret_in = read(STDIN_FILENO, &buffer, BUFFER_SIZE)) > 0){
		// Loop through the input bytes
		int i = 0;
		for (i = 0; i < ret_in; i++) {
			// 4 output bytes per input byte
			ret_out = write(STDOUT_FILENO, encode(buffer[i]), 4);
			if (ret_out != 4){
				// Write error
				errno = EIO;
				perror("Output write");
				return EXIT_FAILURE;
			}
		}
	}

	return EXIT_SUCCESS;
}
